<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAV to MP3 Converter</title>
</head>
<body>
    <input type="file" id="fileInput" accept="audio/wav">
    <button onclick="convertWavToMp3()">Convert WAV to MP3</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.all.js" integrity="sha512-eY0XAD05WDpCg58PUncWwvJhUwwcI92cg/knfPtH4wCf9uhglHEQZT6WwDmqyhdNQJ0pGrHz0nD/9vjHwVw6tA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        // Fungsi untuk mengonversi WAV ke MP3 menggunakan libmp3lame.js
        function encodeMp3(arrayBuffer) {
            const lame = new lamejs();
            const wav = lame.WavHeader.readHeader(new DataView(arrayBuffer));

            if (!wav) {
                alert('Failed to read WAV header');
                return;
            }

            const channels = wav.channels;
            const sampleRate = wav.sampleRate;
            const samples = new Int16Array(arrayBuffer, wav.dataOffset, wav.dataLen / 2);

            const mp3encoder = new lame.Mp3Encoder(channels, sampleRate, 128);
            const mp3Data = [];

            const blockSize = 1152;
            for (let i = 0; i < samples.length; i += blockSize) {
                const sampleChunk = samples.subarray(i, i + blockSize);
                const mp3buf = mp3encoder.encodeBuffer(sampleChunk);
                if (mp3buf.length > 0) {
                    mp3Data.push(mp3buf);
                }
            }
            const mp3buf = mp3encoder.flush();
            if (mp3buf.length > 0) {
                mp3Data.push(new Int8Array(mp3buf));
            }

            return new Blob(mp3Data, { type: 'audio/mp3' });
        }

        // Fungsi untuk mengonversi WAV ke MP3
        function convertWavToMp3() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const arrayBuffer = event.target.result;
                const mp3Blob = encodeMp3(arrayBuffer);
                if (mp3Blob) {
                    const url = URL.createObjectURL(mp3Blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'audio.mp3';
                    link.click();
                }
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
